{"version":3,"file":"worker.js","mappings":"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","sources":["webpack://workerpool/./src/worker.js"],"sourcesContent":["/**\n * worker must be started as a child process or a web worker.\n * It listens for RPC messages from the parent process.\n */\n\n// source of inspiration: https://github.com/sindresorhus/require-fool-webpack\nvar requireFoolWebpack = eval(\n    'typeof require !== \\'undefined\\'' +\n    ' ? require' +\n    ' : function (module) { throw new Error(\\'Module \" + module + \" not found.\\') }'\n);\n\n/**\n * Special message sent by parent which causes the worker to terminate itself.\n * Not a \"message object\"; this string is the entire message.\n */\nvar TERMINATE_METHOD_ID = '__workerpool-terminate__';\n\n// var nodeOSPlatform = require('./environment').nodeOSPlatform;\n\n// create a worker API for sending and receiving messages which works both on\n// node.js and in the browser\nvar worker = {\n  exit: function() {}\n};\nif (typeof self !== 'undefined' && typeof postMessage === 'function' && typeof addEventListener === 'function') {\n  // worker in the browser\n  worker.on = function (event, callback) {\n    addEventListener(event, function (message) {\n      callback(message.data);\n    })\n  };\n  worker.send = function (message) {\n    postMessage(message);\n  };\n}\nelse if (typeof process !== 'undefined') {\n  // node.js\n\n  var WorkerThreads;\n  try {\n    WorkerThreads = requireFoolWebpack('worker_threads');\n  } catch(error) {\n    if (typeof error === 'object' && error !== null && error.code === 'MODULE_NOT_FOUND') {\n      // no worker_threads, fallback to sub-process based workers\n    } else {\n      throw error;\n    }\n  }\n\n  if (WorkerThreads &&\n    /* if there is a parentPort, we are in a WorkerThread */\n    WorkerThreads.parentPort !== null) {\n    var parentPort  = WorkerThreads.parentPort;\n    worker.send = parentPort.postMessage.bind(parentPort);\n    worker.on = parentPort.on.bind(parentPort);\n  } else {\n    worker.on = process.on.bind(process);\n    worker.send = process.send.bind(process);\n    // register disconnect handler only for subprocess worker to exit when parent is killed unexpectedly\n    worker.on('disconnect', function () {\n      process.exit(1);\n    });\n    worker.exit = process.exit.bind(process);\n  }\n}\nelse {\n  throw new Error('Script must be executed as a worker');\n}\n\nfunction convertError(error) {\n  return Object.getOwnPropertyNames(error).reduce(function(product, name) {\n    return Object.defineProperty(product, name, {\n\tvalue: error[name],\n\tenumerable: true\n    });\n  }, {});\n}\n\n/**\n * Test whether a value is a Promise via duck typing.\n * @param {*} value\n * @returns {boolean} Returns true when given value is an object\n *                    having functions `then` and `catch`.\n */\nfunction isPromise(value) {\n  return value && (typeof value.then === 'function') && (typeof value.catch === 'function');\n}\n\n// functions available externally\nworker.methods = {};\n\n/**\n * Execute a function with provided arguments\n * @param {String} fn     Stringified function\n * @param {Array} [args]  Function arguments\n * @returns {*}\n */\nworker.methods.run = function run(fn, args) {\n  var f = new Function('return (' + fn + ').apply(null, arguments);');\n  return f.apply(f, args);\n};\n\n/**\n * Get a list with methods available on this worker\n * @return {String[]} methods\n */\nworker.methods.methods = function methods() {\n  return Object.keys(worker.methods);\n};\n\nvar currentRequestId = null;\n\nworker.on('message', function (request) {\n  if (request === TERMINATE_METHOD_ID) {\n    return worker.exit(0);\n  }\n  try {\n    var method = worker.methods[request.method];\n\n    if (method) {\n      currentRequestId = request.id;\n      \n      // execute the function\n      var result = method.apply(method, request.params);\n\n      if (isPromise(result)) {\n        // promise returned, resolve this and then return\n        result\n            .then(function (result) {\n              worker.send({\n                id: request.id,\n                result: result,\n                error: null\n              });\n              currentRequestId = null;\n            })\n            .catch(function (err) {\n              worker.send({\n                id: request.id,\n                result: null,\n                error: convertError(err)\n              });\n              currentRequestId = null;\n            });\n      }\n      else {\n        // immediate result\n        worker.send({\n          id: request.id,\n          result: result,\n          error: null\n        });\n\n        currentRequestId = null;\n      }\n    }\n    else {\n      throw new Error('Unknown method \"' + request.method + '\"');\n    }\n  }\n  catch (err) {\n    worker.send({\n      id: request.id,\n      result: null,\n      error: convertError(err)\n    });\n  }\n});\n\n/**\n * Register methods to the worker\n * @param {Object} methods\n */\nworker.register = function (methods) {\n\n  if (methods) {\n    for (var name in methods) {\n      if (methods.hasOwnProperty(name)) {\n        worker.methods[name] = methods[name];\n      }\n    }\n  }\n\n  worker.send('ready');\n\n};\n\nworker.emit = function (payload) {\n  if (currentRequestId) {\n    worker.send({\n      id: currentRequestId,\n      isEvent: true,\n      payload\n    });\n  }\n};\n\nif (typeof exports !== 'undefined') {\n  exports.add = worker.register;\n  exports.emit = worker.emit;\n}\n"],"names":["requireFoolWebpack","eval","TERMINATE_METHOD_ID","worker","exit","self","postMessage","addEventListener","on","event","callback","message","data","send","process","WorkerThreads","error","code","parentPort","bind","Error","convertError","Object","getOwnPropertyNames","reduce","product","name","defineProperty","value","enumerable","isPromise","then","methods","run","fn","args","f","Function","apply","keys","currentRequestId","request","method","id","result","params","err","register","hasOwnProperty","emit","payload","isEvent","exports","add"],"sourceRoot":""}