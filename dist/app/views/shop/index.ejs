<%- include('../includes/updated/head.ejs') %>
<script type="text/javascript" src="../materialize/js/init.js" defer></script>
</head>
<body>
    <%- include('../includes/updated/header.ejs') %>
    <%- include('../includes/updated/toaster.ejs') %>
    <main>
        <div class="container">
            <% if(products.length > 0) { %>
                <% let count = 0; %>
                <% products.forEach((product, index) => { %>
                    <% count = count + 1; %>
                    <% if (index === 0) { %>
                        <div class="row equal-height-grid no-menu">
                    <% } %>
                    <% if (index % 3 === 0) { %>
                        </div>
                        <div class="row equal-height-grid no-menu">
                    <% } %>
                        <div class="menu-col col offset-m<%= count %>">
                            <div class="card">
                                <div class="adjust-width-height card-image waves-effect waves-block waves-light">
                                    <img class="activator" src="<%= product.imageUrl %>" alt="<%= lodash.capitalize(product.title) %>">
                                </div>
                                <div class="card-content">
                                    <span class="inline-block-item align-items card-title activator grey-text text-darken-4">
                                        <%= lodash.capitalize(product.title) %>
                                        <i class="material-icons right">more_vert</i>
                                    </span>
                                    <form class="inline-item cube-loader" action="/cart/" method="POST">
                                        <button type="submit" class="icon-btn btn waves-effect waves-light card-title text-darken-4 right">
                                            <i class="material-icons white-text">add_shopping_cart</i>
                                        </button>
                                        <input type="hidden" name="_csrf" value="<%= csrf %>">
                                        <input type="hidden" name="product_id" value="<%= product.id %>">
                                    </form>            
                                    <p>$<%= product.price %></p>
                                </div>
                                <div class="card-reveal">
                                    <span class="card-title grey-text text-darken-4">Product description<i class="material-icons right">close</i></span>
                                    <p><%= lodash.capitalize(product.description) %></p>
                                </div>
                            </div>
                        </div>
                <%})%>
                <% if (typeof pagination_counter === 'number') { %>
                    <ul class="pagination">
                        <% var previous = "" %> 
                        <% var next = "" %> 
                        <% if (pagination_counter === 1) { %>
                            <% previous = "disabled" %> 
                            <% next     = "disabled" %> 
                        <% } else if (pagination_counter > 1 && current_page === 1) {%>
                        <% } else if (pagination_counter > 1 && current_page === pagination_counter) {%>
                            <% previous = "" %> 
                            <% next     = "disabled" %> 
                        <% } else {%>
                            <% previous = "" %> 
                        <% }%>

                        <li class="waves-effect <%= previous %>"><a href="/?page=<%= current_page - 1 <= 0 ? 1 : current_page - 1 %>"><i class="material-icons">chevron_left</i></a></li>
                        <% if (pagination_counter === 1) { %>
                            <li class="active"><a href="/?page=1">1</a></li>
                        <% } else { %>
                            <% for( let index = 1; index <= pagination_counter; index++ ) { %>
                                <% if (current_page !== false && typeof current_page === 'number') { %>
                                    <% if (current_page === index) { %>
                                        <li class="active"><a href="/?page=<%= index %>"><%= index %></a></li>
                                    <% } else {%>
                                        <li class="waves-effect"><a href="/?page=<%= index %>"><%= index %></a></li>
                                    <% } %>
                                <% } else {%>
                                    <li class="waves-effect active"><a href="/?page=<%= index %>"><%= index %></a></li>
                                <% } %>
                            <% } %>
                        <% } %>
                        <li class="waves-effect <%= next %>"><a href="/?page=<%= current_page + 1 > pagination_counter ? 1 : current_page + 1 %>"><i class="material-icons">chevron_right</i></a></li>
                    </ul>
                <% } %>
            <% } else { %>
                <input type="hidden" class="toast_no_products" id="toast_no_products" name="toast_no_products" value="no_products_toast">
            <% } %>
        </div>
    </main>
    <%- include('../includes/updated/footer.ejs') %>
    <%- include('../includes/updated/script.ejs') %>
</body>
</html>
